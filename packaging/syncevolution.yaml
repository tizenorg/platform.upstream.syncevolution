Name: syncevolution
Summary: SyncML Client
Version: 1.3.99.4
Release: 1
Group: Social & Content/Service
License: LGPLv2+
URL: http://syncevolution.org
Sources:
    - "%{name}-%{version}.tar.gz"
Description: |
    The %{name} package contains the core files required to use
    SyncEvolution, a PIM data synchronization solution.
Requires:
    - ca-certificates
PkgBR:
    - boost-devel
    - expat-devel
    - intltool
    - autoconf
    - automake
    - libtool
    - python
    - libxslt-tools
    - libphonenumber-devel
PkgConfigBR:
    - bluez
    - dbus-glib-1
    - gio-2.0
    - glib-2.0
    - libpcre
# TODO: libsoup-gnome-2.4 and proxy settings
    - libsoup-2.4
# for PIM D-Bus service:
    - icu-i18n
    - folks
    - folks-eds

Configure: configure
ConfigOptions:
# Must add -lboost_thread because -lphonenumber can be used with or without real threading.
# We pick real thread-safety.
    - "'PHONENUMBERS_LIBS=-lphonenumber -lboost_thread'"
    - --enable-dbus-service
    - --enable-dbus-service-pim
    - --enable-shared
    - --with-expat=system
    - --enable-release-mode
    - --disable-unit-tests
    - --disable-integration-tests
# for libsynthesis
    - --disable-sqlite

Files:
    - "%{_bindir}/syncevolution"
    - "%{_bindir}/syncevo-webdav-lookup"
    - "%{_libdir}/libsynthesis.so.*"
    - "%{_libdir}/libsmltk.so.*"
    - "%{_libdir}/libsyncevolution.so.*"
    # explicitly list all disabled backends; all enabled
    # ones must be packaged separately
    - "%{_libdir}/syncevolution/backends/syncactivesync.so"
    - "%{_libdir}/syncevolution/backends/syncfile.so"
    - "%{_libdir}/syncevolution/backends/syncxmlrpc.so"
    - "%{_libdir}/syncevolution/backends/syncaddressbook.so"
    - "%{_libdir}/syncevolution/backends/syncsqlite.so"
    - "%{_libdir}/syncevolution/backends/syncmaemocal.so"
    - "%{_libdir}/syncevolution/backends/syncakonadi.so"
    - "%{_libdir}/libgdbussyncevo.*"
    - "%{_libdir}/syncevolution/backends/syncqtcontacts.so"
    - "%{_libdir}/syncevolution/backends/synckcalextended.so"
    - "%{_libdir}/syncevolution/backends/syncdav.so"
    - "%{_libexecdir}/syncevo-dbus-server"
    - "%{_libexecdir}/syncevo-dbus-server-startup.sh"
    - "%{_libexecdir}/syncevo-dbus-helper"
    - "%{_libexecdir}/syncevo-local-sync"
    - "%{_datadir}/syncevolution"
    - "%{_datadir}/doc/syncevolution/*"
    - "%{_datadir}/dbus-1/services/org.syncevolution.service"
    - "%{_datadir}/dbus-1/services/org._01.pim.contacts.service"
    - "%{_sysconfdir}/xdg/autostart/syncevo-dbus-server.desktop"

SubPackages:
    - Name: synccompare
      Summary: optional data comparison for SyncEvolution
      Group: Social & Content/Service
      Description: |
          The %{name}-synccompare package contains a perl script used in
          SyncEvolution command line mode for data comparison. It is optional
          and not normally called when using a GUI.
      Files:
          - "%{_bindir}/synccompare"

    - Name: http-server
      Summary: SyncEvolution HTTP SyncML server
      Group: Social & Content/Service
      Description: |
          The %{name}-http-server package contains a HTTP SyncML server
          based on the Python Twisted framework.
      Files:
          - "%{_bindir}/syncevo-http-server"
      Requires:
          - python-twisted-web

    - Name: phone-config
      Summary: SyncEvolution phone configuration tool
      Group: Social & Content/Service
      Description: |
          The %{name}-http-server package contains a Python script
          which determines via trial-and-error the correct parameters
          for an unknown phone. Not normally needed, most phones work
          with existing templates.
      Files:
          - "%{_bindir}/syncevo-phone-config"

    - Name: devel
      Summary: Development files for %{name}
      Group: Development/Libraries
      Description: |
          The %{name}-devel package contains libraries and header files for
          developing applications that use %{name}.
      Files:
         - "%doc"
         - "%dir %{_includedir}/synthesis"
         - "%{_includedir}/synthesis/*.h"
         - "%{_includedir}/syncevo/*.h"
         - "%{_libdir}/libsynthesis.so"
         - "%{_libdir}/libsmltk.so"
         - "%{_libdir}/libsyncevolution.so"
         - "%{_libdir}/pkgconfig/syncevolution.pc"
         - "%{_libdir}/pkgconfig/synthesis.pc"
         - "%{_libdir}/pkgconfig/synthesis-sdk.pc"

    - Name: ebook
      Summary: SyncEvolution backend for EDS contacts
      Group: Social & Content/Service
      Description: |
          The %{name}-ebook package contains a backend which reads/writes
          contacts in EDS.
      Files:
         - "%{_libdir}/syncevolution/backends/syncebook.so"

    - Name: ecal
      Summary: SyncEvolution backend for EDS events/tasks/memos
      Group: Social & Content/Service
      Description: |
          The %{name}-ecal package contains a backend which reads/writes
          contacts in EDS.
      Files:
         - "%{_libdir}/syncevolution/backends/syncecal.so"

    - Name: pbap
      Summary: SyncEvolution backend for contact caching via PBAP
      Group: Social & Content/Service
      Description: |
          The %{name}-pbap package contains a backend which reads/writes
          contacts via PBAP.
      Files:
         - "%{_libdir}/syncevolution/backends/syncpbap.so"
