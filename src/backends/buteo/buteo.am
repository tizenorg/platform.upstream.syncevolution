# "test" only works when compiling as part of SyncEvolution
dist_noinst_DATA += \
  src/backends/buteo/configure-sub.in \
  src/backends/buteo/README


if ENABLE_BUTEO
include $(top_srcdir)/src/backends/buteo/profiles/profiles.am

# directory required by Buteo for plugins
src_backends_buteo_syncdir = $(libdir)/sync
src_backends_buteo_sync_LTLIBRARIES = src/backends/buteo/libsyncevo-buteo-client.la

src_backends_buteo_built_sources = src/backends/buteo/ButeoBridge.moc.cpp

BUILT_SOURCES += $(src_backends_buteo_built_sources)

src_backends_buteo_libsyncevo_buteo_client_la_SOURCES = \
  src/backends/buteo/ButeoBridge.h \
  src/backends/buteo/ButeoBridge.cpp
nodist_src_backends_buteo_libsyncevo_buteo_client_la_SOURCES = \
  $(src_backends_buteo_built_sources)

src_backends_buteo_libsyncevo_buteo_client_la_LIBADD = $(BUTEO_LIBS) $(QT_LIBS) $(SYNCEVOLUTION_LIBS)
src_backends_buteo_libsyncevo_buteo_client_la_LDFLAGS = -module -avoid-version $(QT_LDFLAGS)
src_backends_buteo_libsyncevo_buteo_client_la_CPPFLAGS = $(SYNCEVOLUTION_CFLAGS) -I$(top_srcdir)/test $(BACKEND_CPPFLAGS) $(QT_CPPFLAGS)
src_backends_buteo_libsyncevo_buteo_client_la_DEPENDENCIES = $(SYNCEVOLUTION_LIBS)

# Allow Qt to set some compile flags, but not the ones normally set via configure.
# In particular -W is not compatible with the SyncEvolution header files (we have
# unused parameters in some inline functions).
src_backends_buteo_libsyncevo_buteo_client_la_CXXFLAGS = $(SYNCEVOLUTION_CXXFLAGS) $(BUTEO_CFLAGS) $(filter-out -O2 -g -W -Wall, $(QT_CXXFLAGS)) $(SYNCEVO_WFLAGS)
endif
